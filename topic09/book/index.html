 <!DOCTYPE html>
 <html>
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
   
     <title> Lab-09 </title>
   
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
     <link rel="stylesheet" href="./style/semantic/css/semantic.min.css" type="text/css">  
     <link rel="stylesheet" href="./style/custom/main.css" type="text/css"> 
   
     <script src="./style/custom/jquery-2.1.0.min.js"></script> 
     <script src="./style/custom/jquery.address-1.6.min.js"></script>
     <script src="./style/semantic/javascript/semantic.min.js"></script>
   
     <link rel="stylesheet" href="./style/highlight/school_book.css">
     <script src="./style/highlight/highlight.pack.js"></script> 
     <script>hljs.initHighlightingOnLoad();</script>
   
     <script src="./style/custom/common.js"> </script> 
     <script src="./style/custom/main.js"> </script> 
  </head>
  <body>
  <nav class="ui fixed top pointing borderless inverted menu">
    <header class="header item"> <a href="../index.html">Databases
</a></header>
    <div class="right tab-menu menu">
          <a class="item" data-tab="Lab-09"> Lab-09 </a>
          <a class="item" data-tab="01"> 01 </a>
          <a class="item" data-tab="02"> 02 </a>
          <a class="item" data-tab="03"> 03 </a>
          <a class="item" data-tab="04"> 04 </a>
          <a class="item" data-tab="05"> 05 </a>
          <a class="item" data-tab="06"> 06 </a>
          <a class="item" data-tab="Exercises"> Exercises </a>
    </div>
  </nav>

  <br>

	  <section data-tab="Lab-09" class="ui tab stacked moodle-book segment">
	     <h1>Objectives</h1>
<ul>
<li>Bring in Semantic UI</li>
<li>Support deletion of Clubs, Divisions and Sponsors</li>
<li>Introduce ability to add players</li>
</ul>
	  </section>
	  <section data-tab="01" class="ui tab stacked moodle-book segment">
	     <h1>Semantic UI</h1>
<p>Using your project form last week, or this archive here:</p>
<ul>
<li><a href="archives/jpamodel-lab08.zip">jpamodel.zip</a></li>
</ul>
<p>We wish to ncorporate the latest version of the semantic ui css framework into your application, and restyle all of the views to take advantage of the framework.</p>
<p>Download the latest Semsntic UI archive here:</p>
<ul>
<li><a href="http://semantic-ui.com/">http://semantic-ui.com/</a></li>
</ul>
<p>Unzip the archvive. It contains subfolder called <code>packaged</code>. Rename this to <code>semantic</code>, and drag the newly renamed subfolder into the public folder of your project.</p>
<p>We should also update the version of JQuery in the public/javascripts folder. It can be downloaded here:</p>
<ul>
<li><a href="http://jquery.com/download/">http://jquery.com/download/</a></li>
</ul>
<p>Select the 2.x 'compressed' version.</p>
<p>We can now replace the <code>views/main.html</code> with this version:</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;#{get 'title' /}&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;@{'/public/semantic/css/semantic.min.css'}&quot;&gt;
    &lt;script src=&quot;@{'/public/javascripts/jquery-2.1.0.min.js'}&quot;&gt;&lt;/script&gt; 
    &lt;script src=&quot;@{'/public/semantic/javascript/semantic.min.js'}&quot;&gt;&lt;/script&gt;   
  &lt;/head&gt;    
  &lt;body&gt;
    #{doLayout /}
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>To test out the UI, simply give each <code>&lt;nav&gt;</code> element this class <code>class="ui menu"</code> :</p>
<pre><code class="html">&lt;nav class=&quot;ui menu&quot;&gt;
</code></pre>

<p>You should see a minimally styled menu on all screens.</p>
<p>Now make each section have the following class:</p>
<pre><code class="html">&lt;section class=&quot;ui raised segment&quot;&gt;   
</code></pre>

<p>A light border should appear around each view.</p>
<p>Finally, style all of the tables:</p>
<pre><code class="html">&lt;table class=&quot;ui table&quot;&gt;
</code></pre>

<p>Finally, adjust the link on <code>views/players/index.html</code> to look more like a button via the  class <code>ui mini teal button</code></p>
<pre><code class="html">&lt;td&gt; &lt;a class=&quot;ui mini teal button&quot; href=&quot;/players/delete/${player.id}&quot;&gt;Delete&lt;/a&gt; &lt;/td&gt;
</code></pre>

<p>An alternative might be to use an icon button:</p>
<pre><code class="html">&lt;td&gt; 
  &lt;a class=&quot;ui ui icon button&quot; href=&quot;/players/delete/${player.id}&quot;&gt;
    &lt;i class=&quot;delete red icon&quot;&gt;&lt;/i&gt;
  &lt;/a&gt; 
&lt;/td&gt;
</code></pre>

<p>Try out these styles now.</p>
	  </section>
	  <section data-tab="02" class="ui tab stacked moodle-book segment">
	     <h1>Delete Club</h1>
<p>First introduce the delete button in the clubs view:</p>
<pre><code class="html">          &lt;td&gt; 
            &lt;a class=&quot;ui ui icon button&quot; href=&quot;/clubs/delete/${club.id}&quot;&gt;
             &lt;i class=&quot;delete red icon&quot;&gt;&lt;/i&gt;
            &lt;/a&gt; 
          &lt;/td&gt;
</code></pre>

<p>We need a supporting route:</p>
<pre><code>GET    /clubs/delete/{id}                       Clubs.delete
</code></pre>

<p>... and this method in the Clubs controller:</p>
<pre><code class="java">  public static void delete(Long id)
  {
    Club club = Club.findById(id);
    if (club != null)
    {
      Logger.info(&quot;Trying to delete &quot; + club.name);
      List&lt;Division&gt; divisions = Division.findAll();
      for (Division division : divisions)
      {
        if (division.members.contains(club))
        {
          division.members.remove(club);
          division.save();
          Logger.info (&quot;removing club from division&quot;);
        }
      }
      club.delete();
    }
    index();
  } 
</code></pre>

<p>Try deleting clubs now.</p>
	  </section>
	  <section data-tab="03" class="ui tab stacked moodle-book segment">
	     <h1>Delete Divisions</h1>
<h2>New routes:</h2>
<pre><code>GET    /divisions/delete/{id}                   Divisions.delete
</code></pre>

<h2>views/Divisions/index.html</h2>
<pre><code class="html">          &lt;td&gt; 
            &lt;a class=&quot;ui ui icon button&quot; href=&quot;/divisions/delete/${division.id}&quot;&gt;
             &lt;i class=&quot;delete red icon&quot;&gt;&lt;/i&gt;
            &lt;/a&gt; 
          &lt;/td&gt;
</code></pre>

<h2>controllers/Divisions.java</h2>
<pre><code class="java">  public static void delete(Long id)
  {
    Division division = Division.findById(id);
    division.delete();
    index();
  }
</code></pre>

<p>When you delete a division, pay close attention to the clubs and players tables. </p>
<p>Can you explain what is happening?</p>
	  </section>
	  <section data-tab="04" class="ui tab stacked moodle-book segment">
	     <h1>Show Sponsors</h1>
<p>Currently the Spnosor table is incomplete - it only lists the sponsor names, and not the club being sponsored:</p>
<pre><code class="html">  &lt;table class=&quot;ui table&quot;&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;Sponsor&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        #{list items:sponsors, as:'sponsor'}
          &lt;tr&gt;
            &lt;td&gt;${sponsor.name}&lt;/td&gt;
            &lt;td&gt;&lt;/td&gt;
            &lt;td&gt;&lt;/td&gt;
          &lt;/tr&gt;
        #{/list}
    &lt;/tbody&gt;
  &lt;/table&gt;
</code></pre>

<p>We can fix this now:</p>
<pre><code class="html">  &lt;table class=&quot;ui table&quot;&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;Sponsor&lt;/th&gt;
        &lt;th&gt;Clubs&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
        #{list items:sponsors, as:'sponsor'}
          &lt;tr&gt;
            &lt;td&gt;${sponsor.name}&lt;/td&gt;
          &lt;td&gt; 
            &lt;table class &quot;ui table&quot;&gt;
              &lt;tr&gt;
               #{list items:sponsor.support, as:'club'}
                 &lt;td&gt;${club.name}&lt;/td&gt; &lt;/tr&gt;
               #{/list}
               &lt;/tr&gt;
             &lt;/table&gt;            
          &lt;/td&gt;
            &lt;td&gt;&lt;/td&gt;
          &lt;/tr&gt;
        #{/list}
    &lt;/tbody&gt;
  &lt;/table&gt;
</code></pre>

<p>However, of you run the app you will see that the sponsors table doesnt contain any clubs. This is because there are no sponsor-club relationships in our test data.</p>
<p>To fix this takes a bit of work, because we have a <code>ManyToMany</code> relationship, which requires definition on both sides. </p>
<p>Open the data.yaml file (the one in the <code>conf</code> directory), and copy the following in at the very top of the file (we already have these at the end, leave them there as well):</p>
<pre><code>Sponsor(pub):
    name: pub 

Sponsor(newsagent):
    name: newsagent    
</code></pre>

<p>Now adjust fenor and tramore to have some sponsors:</p>
<pre><code>Club(tramore):
    name: tramore
    sponsors:
          - pub
          - newsagent

Club(fenor):
    name: fenor
    sponsors:
          - newsagent 
</code></pre>

<p>and finally, at the end of the yaml file, include the 'other side' of the relationship in the sponsors:</p>
<pre><code>Sponsor(newsagent):
    name: newsagent
    support:
         - tramore
         - fenor

Sponsor(pub):
    name: pub 
    support:
         - tramore
</code></pre>

<p>Try this out now, and sponsors should show the clubs they support.</p>
<p>Here is the complete yaml file:</p>
<pre><code>
Sponsor(pub):
    name: pub 

Sponsor(newsagent):
    name: newsagent    

Club(dunmore):
    name: dunmore

Club(tramore):
    name: tramore
    sponsors:
          - pub
          - newsagent

Club(fenor):
    name: fenor
    sponsors:
          - newsagent   

Player(jim):
    name: jim
    club: dunmore

Player(mary):
    name: mary
    club: dunmore

Player(sam):
    name: sam
    club: tramore

Player(john):
    name: john
    club: tramore

Player(mike):
    name: mike
    club: fenor

Player(linda):
    name: linda
    club: fenor    

Division(senior):
    name: senior
    members:
            - tramore
            - dunmore

Division(junior):
    name: junior
    members:
            - fenor

Sponsor(newsagent):
    name: newsagent
    support:
         - tramore
         - fenor

Sponsor(pub):
    name: pub 
    support:
         - tramore
</code></pre>
	  </section>
	  <section data-tab="05" class="ui tab stacked moodle-book segment">
	     <h1>Delete Sponsors</h1>
<h1>New route:</h1>
<pre><code>GET    /sponsors/delete/{id}                    Sponsors.delete
</code></pre>

<h2>views/Sponsors/index.html</h2>
<pre><code class="html">          &lt;td&gt; 
            &lt;a class=&quot;ui ui icon button&quot; href=&quot;/sponsors/delete/${sponsor.id}&quot;&gt;
             &lt;i class=&quot;delete red icon&quot;&gt;&lt;/i&gt;
            &lt;/a&gt; 
          &lt;/td&gt;
</code></pre>

<h2>controllers/Sponsors.java</h2>
<pre><code>  public static void delete(Long id)
  {
    Sponsor sponsor = Sponsor.findById(id);

    for (Club club  : sponsor.support)
    {
      club.sponsors.remove(sponsor);
      club.save();
    }

    sponsor.delete();
    index();
  }  
</code></pre>

<p>Look carefully at the delete method. Can you make sense of it?</p>
	  </section>
	  <section data-tab="06" class="ui tab stacked moodle-book segment">
	     <h1>New Player</h1>
<p>We would like a way of adding a new player via the UI.</p>
<p>First, bring in a new button on the player view to trigger the creating of a player:</p>
<pre><code class="html">  &lt;a class=&quot;ui blue button&quot; href=&quot;/players/addplayer&quot;&gt;
    &lt;i class=&quot;user icon&quot;&gt;&lt;/i&gt; Add Player
  &lt;/a&gt; 
</code></pre>

<p>Then the routes:</p>
<pre><code>GET    /players/addplayer                       Players.addPlayer
POST   /players/newplayer                       Players.newPlayer
</code></pre>

<p>..and the method in Players to display the add player form:</p>
<pre><code class="java">  public static void addPlayer()
  {
    render();
  }

  public static void newPlayer(String name)
  {
    Player player = new Player (name);
    player.save();
    index();
  }
</code></pre>

<p>We also need a form</p>
<h2>views/Players/addplayer.html</h2>
<pre><code class="html">#{extends 'main.html' /}
#{set title:'Player Details' /}

&lt;section class=&quot;ui raised form segment&quot;&gt;
  &lt;form action=&quot;/players/newplayer&quot; method=&quot;POST&quot;&gt;
    &lt;div class=&quot;field&quot;&gt;
      &lt;label&gt; Player Name &lt;/label&gt;
      &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;
    &lt;/div&gt;  
    &lt;button class=&quot;ui blue submit button&quot;&gt;Add&lt;/button&gt;
  &lt;/form&gt;
&lt;/section&gt;
</code></pre>

<p>Try this out now. </p>
<p>You will get an error - as you have added a player, however not associated the player with a club. The club is a 'null' reference in the database, and causes the view to fail.</p>
<p>We can fix this easily, permitting 'unattached' players. Open <code>views/Players/index.html</code> and replace this line:</p>
<pre><code class="html">&lt;td&gt;  ${player.club.name} &lt;/td&gt;
</code></pre>

<p>with this:</p>
<pre><code class="html">&lt;td&gt;  ${player.club?.name} &lt;/td&gt;
</code></pre>

<p>There is a very small difference. This is using a <code>null-safe</code> operator <code>?</code> when trying to access the clubs name. If the club is null (i.e. there is no club), we will not attempt to reach into the name field.</p>
<p>Make sure this works now as expected.</p>
	  </section>
	  <section data-tab="Exercises" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<p>Archive of project so far:</p>
<ul>
<li><a href="archives/jpamodel.zip">jpamodel.zip</a></li>
</ul>
<h2>Exercise 1</h2>
<p>On the clubs page, have the table display the sponsors.</p>
<h2>Exercise 2</h2>
<p>Following on from step 7, provide buttons/views to create Clubs, Divisions and Sponsors. You may need to use the <code>null safe</code> operator from step 7 to do this effectively.</p>
<h2>Exercise 3</h2>
<p>We still dont have a way of enabling the user to establish associations between the different models. E.g. have new player belong to a club, or clubs be in a division etc..</p>
<p>How would you approach this?</p>
	  </section>
  <div class="ui fixed bottom borderless menu">'
    <div class="ui small item"> 
    <p id="footertext">
    Prepared by  Eamonn de Leastar (edeleastar@wit.ie). Except where otherwise noted, this content is licensed under a  
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/" 
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>   
    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-49703418-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>  </body>
 </html>